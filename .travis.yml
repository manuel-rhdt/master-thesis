os: linux
dist: xenial

language: rust
rust: stable

jobs:
  include:
    - language: python
      python: "3.8"
      addons:
        apt:
          packages:
            - pandoc
            - pandoc-citeproc
      install:
        - pip install -r requirements.txt
      script:
        - docs/build-book.py
      deploy:
        provider: pages
        token: $GITHUB_TOKEN
        keep_history: true
        local_dir: _site
        edge: true
        on:
          branch: master
    - language: rust
      rust: stable
      before_install: cd accelerate
      cache: cargo
    - stage: deploy
      script: skip
      before_install: cd accelerate
      install: cargo build --verbose --release
      deploy:
        provider: releases
        edge: true
        token: $GITHUB_TOKEN
        file: target/release/accelerate
        draft: true
        on:
          tags: true
